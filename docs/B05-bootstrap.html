<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-0.9.629">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Introduction to Machine Learning for Economists (Under Construction) - 5&nbsp; Bootstrap</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./P01-random-forest.html" rel="next">
<link href="./B04-regularization.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<link href="style.css" rel="stylesheet" type="text/css">

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-45VKT2HZSL"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() { dataLayer.push(arguments); }
  gtag('js', new Date());

  gtag('config', 'G-45VKT2HZSL');
</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Bootstrap</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Introduction to Machine Learning for Economists (Under Construction)</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/tmieno2/ML-Economist" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
    <a href="" title="Share" id="sidebar-tool-dropdown-0" class="sidebar-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-share"></i></a>
    <ul class="dropdown-menu" aria-labelledby="sidebar-tool-dropdown-0">
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
            <i class="bi bi-bi-twitter pe-1"></i>
          Twitter
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
            <i class="bi bi-bi-facebook pe-1"></i>
          Facebook
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=|url|">
            <i class="bi bi-bi-linkedin pe-1"></i>
          LinkedIn
          </a>
        </li>
    </ul>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Welcome</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./H00-preface.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Basics</a>
      <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./B01-nonlinear.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Non-linear function estimation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./B02-bias-variance-tradeoff.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Bias-variance Trade-off</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./B03-cross-validation.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Cross-validation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./B04-regularization.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Regression Shrinkage Methods</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./B05-bootstrap.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Bootstrap</span></a>
  </div>
</li>
    </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Prediction ML</a>
      <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./P01-random-forest.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Random Forest</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./P02-boosted-regression-forest.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Boosted Regression Forest</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./P03-xgb.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Extreme Gradient Boosting</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./P04-local-linear-forest.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Local Linear Forest</span></a>
  </div>
</li>
    </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a href="./C0P-causal-ml.html" class="sidebar-item-text sidebar-link">Causal Machine Learning (CML) Methods</a>
      <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C00-why-not-this.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Why can’t we just do this?</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C01-dml.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Double Machine Learning</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C02-xstr-learner.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">S-, X-, T-, and R-learner</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C03-cf-orf.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Forest-based CATE Estimators</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C04-cf-extension.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Extensions of Causal Forest</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C05-causal-model-selection.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Causal Model Selection</span></a>
  </div>
</li>
    </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a href="./E0P-extensions.html" class="sidebar-item-text sidebar-link">Extensions</a>
      <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./E01-spatial-cv.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Spatial Cross-validation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./E02-grf.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Generalized Random Forest</span></a>
  </div>
</li>
    </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">Programming: R</a>
      <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./PROG-R-01-mlr3.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Machine Learning with <code>mlr3</code></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./PROG-R-02-reticulate.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Running Python from R</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./PROG-R-03-model-selection-prediction.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Model Selection (Prediction)</span></a>
  </div>
</li>
    </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">Programming: Python</a>
      <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./PROG-P-01-scikitlearn.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Prediction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./PROG-P-02-CATE-econml.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Treatment Effect Estimation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./PROG-P-03-model-selection.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Model selection</span></a>
  </div>
</li>
    </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">Appendices</a>
      <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A01-mc-simulation.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Monte Carlo (MC) Simulation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A02-method-of-moment.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Primer on method of moment</span></a>
  </div>
</li>
    </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#what-is-it-for" id="toc-what-is-it-for" class="nav-link active" data-scroll-target="#what-is-it-for"> <span class="header-section-number">5.1</span> What is it for?</a></li>
  <li><a href="#how-it-works" id="toc-how-it-works" class="nav-link" data-scroll-target="#how-it-works"> <span class="header-section-number">5.2</span> How it works</a></li>
  <li><a href="#sec-boot-comp" id="toc-sec-boot-comp" class="nav-link" data-scroll-target="#sec-boot-comp"> <span class="header-section-number">5.3</span> A more complicated example</a></li>
  <li><a href="#one-more-example-with-a-non-parametric-model" id="toc-one-more-example-with-a-non-parametric-model" class="nav-link" data-scroll-target="#one-more-example-with-a-non-parametric-model"> <span class="header-section-number">5.4</span> One more example with a non-parametric model</a></li>
  <li><a href="#bag-of-little-bootstraps" id="toc-bag-of-little-bootstraps" class="nav-link" data-scroll-target="#bag-of-little-bootstraps"> <span class="header-section-number">5.5</span> Bag of Little Bootstraps</a>
  <ul class="collapse">
  <li><a href="#demonstrations" id="toc-demonstrations" class="nav-link" data-scroll-target="#demonstrations"> <span class="header-section-number">5.5.1</span> Demonstrations</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/tmieno2/ML-Economist/edit/master/B05-bootstrap.qmd" class="toc-action">Edit this page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="sec-boot" class="quarto-section-identifier d-none d-lg-block"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Bootstrap</span></span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<section id="what-is-it-for" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="what-is-it-for"><span class="header-section-number">5.1</span> What is it for?</h2>
<p>Bootstrap can be used to quantify the uncertainty associated with an estimator. For example, you can use it to estimate the standard error (SE) of a coefficient of a linear model. Since there are closed-form solutions for that, bootstrap is not really bringing any benefits to this case. However, the power of bootstrap comes in handy when you do NOT have a closed form solution. We will first demonstrate how bootstrap works using a linear model, and then apply it to a case where no-closed form solution is available.</p>
</section>
<section id="how-it-works" class="level2 page-columns page-full" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="how-it-works"><span class="header-section-number">5.2</span> How it works</h2>

<div class="no-row-height column-margin column-container"><div class="">
<p><strong>Packages to load for replication</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mgcv)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(parallel)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fixest)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ranger)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div></div><p>Here are the general steps of a bootstrap:</p>
<ul>
<li>Step 1: Sample the data with replacement (You can sample the same observations more than one times. You draw a ball and then you put it back in the box.)</li>
<li>Step 2: Run a statistical analysis to estimate whatever quantity you are interested in estimating</li>
<li>Repeat Steps 1 and 2 many times and store the estimates</li>
<li>Derive uncertainty measures from the collection of estimates obtained above</li>
</ul>
<p>Let’s demonstrate this using a very simple linear regression example.</p>
<p>Here is the data generating process:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">89343</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> x <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">rnorm</span>(N)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We would like to estimate the coefficient on <span class="math inline">\(x\)</span> by applying OLS to the following model:</p>
<p><span class="math display">\[
y = \alpha + \beta_x + \mu
\]</span></p>
<p>We know from the econometric theory class that the SE of <span class="math inline">\(\hat{\beta}_{OLS}\)</span> is <span class="math inline">\(\frac{\sigma}{\sqrt{SST_x}}\)</span>, where <span class="math inline">\(\sigma^2\)</span> is the variance of the error term (<span class="math inline">\(\mu\)</span>) and <span class="math inline">\(SST_x = \sum_{i=1}^N (x_i - \bar{x})^2\)</span> (<span class="math inline">\(\bar{x}\)</span> is the mean of <span class="math inline">\(x\)</span>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>mean_x <span class="ot">&lt;-</span> <span class="fu">mean</span>(x)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>sst_x <span class="ot">&lt;-</span> ((x<span class="sc">-</span><span class="fu">mean</span>(x))<span class="sc">^</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> <span class="fu">sum</span>()</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>se_bhat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="dv">4</span> <span class="sc">/</span> sst_x)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.217933</code></pre>
</div>
</div>
<p>So, we know that the true SE of <span class="math inline">\(\hat{\beta}_{OLS}\)</span> is 0.217933. There is not really any point in using bootstrap in this case, but this is a good example to see if bootstrap works or not.</p>
<p>Let’s implement a single iteration of the entire bootstrap steps (Steps 1 and 2).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#=== set up a dataset ===#</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.table</span>(</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> y,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> x</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, draw observations with replacement so the resulting dataset has the same number of observations as the original dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>num_obs <span class="ot">&lt;-</span> <span class="fu">nrow</span>(data)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">#=== draw row numbers ===#</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>row_indices <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">seq_len</span>(num_obs), num_obs, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] 29 56 39 83 52 66 70 19  4 34 28 34 81 32  9 95 99 86  4 79 30 15 41 97 43
 [26] 89 60 41 16 19 66 96 34 91 86 67 75 28 74 50 71 95 74 87 58 27  9 65 80 41
 [51] 71 64 21 47 45 77 97 94 72 50 23 10 33 45 14 17 82 56 33 75 70 63 78 81 64
 [76] 16 84 90  2 17  5 46 53 37 93 85 72 63 10 35 42 20 70 49 74 32 25 73 76 32</code></pre>
</div>
</div>
<p>Use the sampled indices to create a bootstrapped dataset:</p>

<div class="no-row-height column-margin column-container"><div class="">
<p>You could also use <code>bootstraps()</code> from the <code>rsample</code> package.</p>
</div></div><div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>temp_data <span class="ot">&lt;-</span> data[row_indices, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, apply OLS to get a coefficient estimate on <span class="math inline">\(x\)</span> using the bootstrapped dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> temp_data)<span class="sc">$</span>coefficient[<span class="st">"x"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       x 
2.040957 </code></pre>
</div>
</div>
<p>This is the end of Steps 1 and 2. Now, let’s repeat this step 1000 times. First, we define a function that implements Steps 1 and 2.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>get_beta <span class="ot">&lt;-</span> <span class="cf">function</span>(i, data)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  num_obs <span class="ot">&lt;-</span> <span class="fu">nrow</span>(data)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#=== sample row numbers ===#</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  row_indices <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">seq_len</span>(num_obs), num_obs, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#=== bootstrapped data ===#</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  temp_data <span class="ot">&lt;-</span> data[row_indices, ]</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#=== get coefficient ===#</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  beta_hat <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> temp_data)<span class="sc">$</span>coefficient[<span class="st">"x"</span>]</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(beta_hat)</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now repeat <code>get_beta()</code> many times:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>beta_store <span class="ot">&lt;-</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(x) <span class="fu">get_beta</span>(x, data)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlist</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Calculate standard deviation of <span class="math inline">\(\hat{\beta}_{OLS}\)</span>,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(beta_store)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2090611</code></pre>
</div>
</div>
<p>Not, bad. What if we make the number of observations to 1000 instead of 100?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">67343</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co">#=== generate data ===#</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> x <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">rnorm</span>(N)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co">#=== set up a dataset ===#</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.table</span>(</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> y,</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> x</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="co">#=== true SE ===#</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>mean_x <span class="ot">&lt;-</span> <span class="fu">mean</span>(x)</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>sst_x <span class="ot">&lt;-</span> <span class="fu">sum</span>(((x<span class="sc">-</span><span class="fu">mean</span>(x))<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>se_bhat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="dv">4</span> <span class="sc">/</span> sst_x)</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.06243842</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#=== bootstrap-estimated SE ===#</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>beta_store <span class="ot">&lt;-</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(x) <span class="fu">get_beta</span>(x, data)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlist</span>()</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(beta_store)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.06147708</code></pre>
</div>
</div>
<p>This is just a single simulation. So, we cannot say bootstrap works better when the number of sample size is larger only from these experiments. But, it is generally true that bootstrap indeed works better when the number of sample size is larger.</p>
</section>
<section id="sec-boot-comp" class="level2 page-columns page-full" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="sec-boot-comp"><span class="header-section-number">5.3</span> A more complicated example</h2>
<p>Consider a simple production function (e.g., yield response functions for agronomists):</p>
<p><span class="math display">\[
y = \beta_1 x + \beta_2 x^2 + \mu
\]</span></p>
<ul>
<li><span class="math inline">\(y\)</span>: output</li>
<li><span class="math inline">\(x\)</span>: input</li>
<li><span class="math inline">\(\mu\)</span>: error</li>
</ul>
<p>The price of <span class="math inline">\(y\)</span> is 5 and the cost of <span class="math inline">\(x\)</span> is 2. Your objective is to identify the amount of input that maximizes profit. You do not know <span class="math inline">\(\beta_1\)</span> and <span class="math inline">\(\beta_2\)</span>, and will be estimating them using the data you have collected. Letting <span class="math inline">\(\hat{\beta_1}\)</span> and <span class="math inline">\(\hat{\beta_2}\)</span> denote the estimates of <span class="math inline">\(\beta_1\)</span> and <span class="math inline">\(\beta_2\)</span>, respectively, the mathematical expression of the optimization problem is:</p>
<p><span class="math display">\[
Max_x 5(\hat{\beta}_1 x + \hat{\beta}_2 x^2) - 2 x
\]</span></p>
<p>The F.O.C is</p>
<p><span class="math display">\[
5\hat{\beta}_1 + 10 \hat{\beta}_2 x - 2 = 0
\]</span></p>
<p>So, the estimated profit-maximizing input level is <span class="math inline">\(\hat{x}^* = \frac{2-5\hat{\beta}_1}{10\hat{\beta}_2}\)</span>. What we are interested in knowing is the SE of <span class="math inline">\(x^*\)</span>. As you can see, it is a non-linear function of the coefficients, which makes it slightly harder than simply getting the SE of <span class="math inline">\(\hat{\beta_1}\)</span> or <span class="math inline">\(\hat{\beta_2}\)</span>. However, bootstrap can easily get us an estimate of the SE of <span class="math inline">\(\hat{x}^*\)</span>. The bootstrap process will be very much the same as the first bootstrap example except that we will estimate <span class="math inline">\(x^*\)</span> in each iteration instead of stopping at estimating just coefficients. Let’s work on a single iteration first.</p>

<div class="no-row-height column-margin column-container"><div class="">
<p>Alternatively, you could use the delta method, which lets you find an estimate of the SE of a statistics that is a non-linear function of estimated coefficients.</p>
</div></div><p>Here is the data generating process:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">894334</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span>  <span class="dv">1000</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span>  <span class="fu">runif</span>(N) <span class="sc">*</span> <span class="dv">3</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>ey <span class="ot">&lt;-</span> <span class="dv">6</span> <span class="sc">*</span> x <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> x<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">rnorm</span>(N)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> ey <span class="sc">+</span> mu</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> </span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.table</span>(</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> x,</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> y,</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">ey =</span> ey</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Under the data generating process, here is what the production function looks like:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> data) <span class="sc">+</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> ey, <span class="at">x =</span> x)) <span class="sc">+</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="B05-bootstrap_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="480"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>num_obs <span class="ot">&lt;-</span> <span class="fu">nrow</span>(data)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>row_indices <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">seq_len</span>(num_obs), num_obs, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>boot_data <span class="ot">&lt;-</span> data[row_indices, ]</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>reg <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x <span class="sc">+</span> <span class="fu">I</span>(x<span class="sc">^</span><span class="dv">2</span>), <span class="at">data =</span> boot_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now that we have estimated <span class="math inline">\(\beta_1\)</span> and <span class="math inline">\(\beta_2\)</span>, we can easily estimate <span class="math inline">\(x^*\)</span> using its analytical formula.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>x_star <span class="ot">&lt;-</span> (<span class="dv">2</span> <span class="sc">-</span> <span class="dv">5</span> <span class="sc">*</span> reg<span class="sc">$</span>coef[<span class="st">"x"</span>])<span class="sc">/</span> (<span class="dv">10</span> <span class="sc">*</span> reg<span class="sc">$</span>coef[<span class="st">"I(x^2)"</span>])</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      x 
1.40625 </code></pre>
</div>
</div>
<p>We can repeat this many times to get a collection of <span class="math inline">\(x^*\)</span> estimates and calculate the standard deviation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>get_x_star <span class="ot">&lt;-</span> <span class="cf">function</span>(i)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  row_indices <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">seq_len</span>(num_obs), num_obs, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  boot_data <span class="ot">&lt;-</span> data[row_indices, ]</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  reg <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x <span class="sc">+</span> <span class="fu">I</span>(x<span class="sc">^</span><span class="dv">2</span>), <span class="at">data =</span> boot_data)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  x_star <span class="ot">&lt;-</span> (<span class="dv">2</span> <span class="sc">-</span> <span class="dv">5</span> <span class="sc">*</span> reg<span class="sc">$</span>coef[<span class="st">"x"</span>])<span class="sc">/</span> (<span class="dv">10</span> <span class="sc">*</span> reg<span class="sc">$</span>coef[<span class="st">"I(x^2)"</span>])</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>x_stars <span class="ot">&lt;-</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>,</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    get_x_star</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlist</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here is the histogram:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(x_stars, <span class="at">breaks =</span> <span class="dv">30</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="B05-bootstrap_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="576"></p>
</div>
</div>
<p>So, it seems to follow a normal distribution. You can get standard deviation of <code>x_stars</code> as an estimate of the SE of <span class="math inline">\(\hat{x}^*\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(x_stars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.01783721</code></pre>
</div>
</div>
<p>You can get the 95% confidence interval (CI) like below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(x_stars, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    2.5%    97.5% 
1.364099 1.430915 </code></pre>
</div>
</div>
</section>
<section id="one-more-example-with-a-non-parametric-model" class="level2 page-columns page-full" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="one-more-example-with-a-non-parametric-model"><span class="header-section-number">5.4</span> One more example with a non-parametric model</h2>
<p>We now demonstrate how we can use bootstrap to get an estimate of the SE of <span class="math inline">\(\hat{x}^*\)</span> when we use random forest (RF) as our regression method instead of OLS. When RF is used, we do not have any coefficients like the OLS case above. Even then, bootstrap allows us to estimate the SE of <span class="math inline">\(\hat{x}^*\)</span>.</p>

<div class="no-row-height column-margin column-container"><div class="">
<p>RF will be covered in <a href="P01-random-forest.html#sec-rf"><span>Section&nbsp;6.2</span></a>. Please take a quick glance at what RF is to confirm this point. No deep understanding of RF is necessary to understand the significance of bootstrap in this example. Please also note that there is no benefit in using RF in this example because we have only one variable and semi-parametric approach like <code>gam()</code> will certainly do better. RF is used here only because it does not give you coefficient estimates (there are no coefficients in the first place for RF) like linear models.</p>
</div></div><p>The procedure is exactly the same except that we use RF to estimate the production function and also that we need to conduct numerical optimization as no analytical formula is available unlike the case above.</p>
<p>We first implement a single iteration.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">#=== get bootstrapped data ===#</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>row_indices <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">seq_len</span>(num_obs), num_obs, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>boot_data <span class="ot">&lt;-</span> data[row_indices, ]</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co">#=== train RF ===#</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>reg_rf <span class="ot">&lt;-</span> <span class="fu">ranger</span>(y <span class="sc">~</span> x, <span class="at">data =</span> boot_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once you train RF, we can predict yield at a range of values of <span class="math inline">\(x\)</span>, calculate profit, and then pick the value of <span class="math inline">\(x\)</span> that maximizes the estimated profit.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co">#=== create series of x values at which yield will be predicted ===#</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>eval_data <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">3</span>, <span class="at">length =</span> <span class="dv">1000</span>))</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co">#=== predict yield based on the trained RF ===#</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>eval_data[, y_hat <span class="sc">:</span><span class="er">=</span> <span class="fu">predict</span>(reg_rf, eval_data)<span class="sc">$</span>predictions]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here is what the estimated production function looks like:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">#=== plot ===#</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> eval_data) <span class="sc">+</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> y_hat, <span class="at">x =</span> x)) <span class="sc">+</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="B05-bootstrap_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid" width="576"></p>
</div>
</div>
<p>Well, it is very spiky (we need to tune hyper-parameters using KCV. But, more on this later. The quality of RF estimation has nothing to do with the goal of this section).</p>
<p>We can now predict profit at each value of <span class="math inline">\(x\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co">#=== calculate profit ===#</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>eval_data[, profit_hat <span class="sc">:</span><span class="er">=</span> <span class="dv">5</span> <span class="sc">*</span> y_hat <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> x]</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(eval_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             x      y_hat profit_hat
1: 0.000000000 -0.4807528  -2.403764
2: 0.003003003 -0.4807528  -2.409770
3: 0.006006006 -0.4807528  -2.415776
4: 0.009009009  1.0193781   5.078872
5: 0.012012012  1.0193781   5.072866
6: 0.015015015  1.2466564   6.203252</code></pre>
</div>
</div>
<p>The only thing left for us to do is find the <span class="math inline">\(x\)</span> value that maximizes profit.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>eval_data[<span class="fu">which.max</span>(profit_hat), ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          x    y_hat profit_hat
1: 1.273273 8.675033   40.82862</code></pre>
</div>
</div>
<p>Okay, so 1.2732733 is the <span class="math inline">\(\hat{x}^*\)</span> from this iteration.</p>
<p>As you might have guessed already, we can just repeat this step to get an estimate of the SE of <span class="math inline">\(\hat{x}^*_{RF}\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>get_x_star_rf <span class="ot">&lt;-</span> <span class="cf">function</span>(i)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(i) <span class="co"># progress tracker</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#=== get bootstrapped data ===#</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  row_indices <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">seq_len</span>(num_obs), num_obs, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  boot_data <span class="ot">&lt;-</span> data[row_indices, ]</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#=== train RF ===#</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>  reg_rf <span class="ot">&lt;-</span> <span class="fu">ranger</span>(y <span class="sc">~</span> x, <span class="at">data =</span> boot_data)</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#=== create series of x values at which yield will be predicted ===#</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>  eval_data <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">3</span>, <span class="at">length =</span> <span class="dv">1000</span>))</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">#=== predict yield based on the trained RF ===#</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>  eval_data[, y_hat <span class="sc">:</span><span class="er">=</span> <span class="fu">predict</span>(reg_rf, eval_data)<span class="sc">$</span>predictions]</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">#=== calculate profit ===#</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>  eval_data[, profit_hat <span class="sc">:</span><span class="er">=</span> <span class="dv">5</span> <span class="sc">*</span> y_hat <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> x]</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">#=== find x_star_hat ===#</span></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>  x_star_hat <span class="ot">&lt;-</span> eval_data[<span class="fu">which.max</span>(profit_hat), x]</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x_star_hat)</span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="B05-bootstrap_cache/html/unnamed-chunk-29_5f69e998d3688a4725d12f319e7fef6c">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>x_stars_rf <span class="ot">&lt;-</span> </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mclapply</span>(</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>,</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    get_x_star_rf,</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">mc.cores =</span> <span class="dv">12</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlist</span>()</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="co">#=== Windows user ===#</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="co"># library(future.apply)</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="co"># plan("multisession", workers = detectCores() - 2)</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="co"># x_stars_rf &lt;- </span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="co">#   future_lapply(</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a><span class="co">#     1:1000,</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a><span class="co">#     get_x_star_rf</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) %&gt;%</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a><span class="co">#   unlist()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here are the estimate of the SE of <span class="math inline">\(\hat{x}^*_{RF}\)</span> and 95% CI.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(x_stars_rf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3949154</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(x_stars_rf, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     2.5%     97.5% 
0.5465465 2.0570571 </code></pre>
</div>
</div>
<p>As you can see, the estimation of <span class="math inline">\(x^*\)</span> is much more inaccurate than the previous OLS approach. This is likely due to the fact that we are not doing a good job of tuning the hyper-parameters of RF (but, again, more on this later).</p>
<p>This conclude the illustration of the power of using bootstrap to estimate the uncertainty of the statistics of interest (<span class="math inline">\(x^*\)</span> here) when the analytical formula of the statistics is non-linear or not even known.</p>
</section>
<section id="bag-of-little-bootstraps" class="level2 page-columns page-full" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="bag-of-little-bootstraps"><span class="header-section-number">5.5</span> Bag of Little Bootstraps</h2>
<p>Bag of little bootstraps (BLB) is a variant of bootstrap that has similar desirable statistical properties as bootstrap, but is more (computer) memory friendly <span class="citation" data-cites="kleiner_scalable_2014">(<a href="#ref-kleiner_scalable_2014" role="doc-biblioref">Kleiner et al. 2014</a>)</span>.</p>
<p>When the sample size is large (say 1GB) bootstrap is computationally costly both in terms of time and memory because the data of the same size is bootstrapped for many times (say, 1000 times). BLB overcomes this problem.</p>
<p>Suppose you are interested in <span class="math inline">\(\eta\)</span> (e.g., standard error, confidence interval) of the estimator <span class="math inline">\(\hat{\theta}\)</span>. Further, let <span class="math inline">\(N\)</span> denoted the sample size of the training data.</p>
<p>BLB works as follows:</p>
<ol type="1">
<li>Split the dataset into <span class="math inline">\(S\)</span> sets of subsamples of size <span class="math inline">\(B\)</span> so that <span class="math inline">\(s \times B = N\)</span> <span style="color:blue"> without replacement</span>.</li>
<li>For each of the subsample, bootstrap <span class="math inline">\(N\)</span> (<span style="color:red"> not <span class="math inline">\(B\)</span> </span>) samples <span style="color:blue"> with replacement </span> <span class="math inline">\(M\)</span> times, and find <span class="math inline">\(\eta\)</span> (call it <span class="math inline">\(\eta_s\)</span>) for each of the subsample sets.</li>
<li>Average <span class="math inline">\(\hat{\eta}_s\)</span> to get <span class="math inline">\(\hat{eta}\)</span>.</li>
</ol>
<section id="demonstrations" class="level3 page-columns page-full" data-number="5.5.1">
<h3 data-number="5.5.1" class="anchored" data-anchor-id="demonstrations"><span class="header-section-number">5.5.1</span> Demonstrations</h3>
<p>Let’s go back to the example discussed in <a href="#sec-boot-comp"><span>Section&nbsp;5.3</span></a>, where the goal is to identify the confidence interval (<span class="math inline">\(\eta\)</span>) of the economically optimal input rate (<span class="math inline">\(\theta\)</span>).</p>
<hr>
<p><strong><span style="color:blue"> Step 1: </span></strong></p>

<div class="no-row-height column-margin column-container"><div class="">
<p>Step 1: Split the dataset into <span class="math inline">\(S\)</span> sets of subsamples of size <span class="math inline">\(B\)</span> so that <span class="math inline">\(s \times B = N\)</span> <span style="color:blue"> without replacement</span></p>
</div></div><p>Here, we set <span class="math inline">\(S\)</span> at 5, so <span class="math inline">\(B = 200\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="fu">nrow</span>(data)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>S <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>subsamples <span class="ot">&lt;-</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  data[<span class="fu">sample</span>(<span class="fu">seq_len</span>(N), N), ] <span class="sc">%&gt;%</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>  .[, <span class="at">subgroup :=</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>S, <span class="at">each =</span> N<span class="sc">/</span>S)] <span class="sc">%&gt;%</span> </span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">split</span>(.<span class="sc">$</span>subgroup)</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`1`
             x           y       ey subgroup
  1: 2.3733159  5.30861102 2.974639        1
  2: 1.6275776  3.09436504 4.467448        1
  3: 0.2254504 -0.00443899 1.251047        1
  4: 1.9988901  3.51795123 4.002217        1
  5: 2.6819931  2.65018050 1.705785        1
 ---                                        
196: 0.6356858  1.70404729 3.005922        1
197: 0.5894847  5.41369203 2.841924        1
198: 1.1667444  5.82214614 4.277881        1
199: 0.9570687  4.01145812 3.910451        1
200: 2.6627629  5.73397413 1.795965        1

$`2`
             x           y        ey subgroup
  1: 1.8809192  4.57934497 4.2098011        2
  2: 0.1314569 -0.61561180 0.7541794        2
  3: 2.5253701  1.49742398 2.3972324        2
  4: 0.8415726  5.29003218 3.6329468        2
  5: 0.4067221  3.22079460 2.1094867        2
 ---                                         
196: 0.3281349  5.33737092 1.7534644        2
197: 0.1399768  3.43767708 0.8006737        2
198: 2.6292985 -0.06800098 1.9493698        2
199: 2.3410270  3.73951071 3.0853472        2
200: 2.8142845 -2.75691735 1.0453126        2

$`3`
             x          y          ey subgroup
  1: 1.2296299  5.0020342 4.353800036        3
  2: 0.8974602  5.2290199 3.773891666        3
  3: 1.0734530  1.0161772 4.136115258        3
  4: 2.8013991  2.7505559 1.112720709        3
  5: 1.5841919  4.9322236 4.485823441        3
 ---                                          
196: 0.1508607  1.6273472 0.859646069        3
197: 0.6124024  1.8253166 2.924341101        3
198: 2.9990628 -0.4053550 0.005621654        3
199: 2.8691630 -0.9073811 0.750785549        3
200: 1.0579288  6.2074265 4.109146183        3

$`4`
             x          y       ey subgroup
  1: 2.3998924 -0.8807641 2.880388        4
  2: 1.0257974  6.6735166 4.050264        4
  3: 1.1611026  3.5404186 4.270297        4
  4: 1.0894566  2.5421898 4.162908        4
  5: 0.1975354  0.3857778 1.107172        4
 ---                                       
196: 0.7921199  7.0038608 3.497812        4
197: 2.6279086  1.9564617 1.955645        4
198: 1.4766912  2.8731862 4.498913        4
199: 0.6217361  2.1170408 2.957305        4
200: 2.0381772  1.8095725 3.920731        4

$`5`
             x          y          ey subgroup
  1: 0.5453160 10.3885051 2.677156938        5
  2: 1.2077153  1.2218954 4.329139357        5
  3: 1.1022868  1.8370493 4.183648383        5
  4: 2.9998229 -0.5902619 0.001062293        5
  5: 1.8845175  0.8490326 4.204292516        5
 ---                                          
196: 1.5471997  4.8499174 4.495544367        5
197: 0.5813285  3.7268747 2.812085354        5
198: 1.5839438  7.7635746 4.485906861        5
199: 0.2343757  1.8121762 1.296390509        5
200: 1.9727159  1.9638589 4.053079371        5</code></pre>
</div>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<p>You could alternatively do this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>fold_data <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(data, <span class="at">v =</span> <span class="dv">5</span>)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>subsamples <span class="ot">&lt;-</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(x) fold_data[x, ]<span class="sc">$</span>splits[[<span class="dv">1</span>]] <span class="sc">%&gt;%</span> <span class="fu">assessment</span>()</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div></div><hr>
<p><strong><span style="color:blue"> Steps 2: </span></strong></p>

<div class="no-row-height column-margin column-container"><div class="">
<ul>
<li>Step 2: For each of the subsample, bootstrap <span class="math inline">\(N\)</span> (<span style="color:red"> not <span class="math inline">\(B\)</span> </span>) samples <span style="color:blue"> with replacement </span> <span class="math inline">\(M\)</span> times, and find <span class="math inline">\(\eta\)</span> (call it <span class="math inline">\(\eta_s\)</span>) for each of the subsample sets.</li>
</ul>
</div></div><p>Instead of creating bootstrapped samples <span class="math inline">\(M\)</span> times, only one bootstrapped sample from the first subsample is created for now, and then the estimate of <span class="math inline">\(x^*\)</span> is obtained.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>boot_data <span class="ot">&lt;-</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample</span>(</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">seq_len</span>(<span class="fu">nrow</span>(subsamples[[<span class="dv">1</span>]])),</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>    N,</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">replace =</span> <span class="cn">TRUE</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>  subsamples[[<span class="dv">1</span>]][., ]</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               x          y          ey
   1: 2.99982294 -0.5902619 0.001062293
   2: 0.36841088  0.6414166 1.939012145
   3: 0.36841088  0.6414166 1.939012145
   4: 1.52659488  4.1079431 4.498585425
   5: 2.68124652  1.4721212 1.709313320
  ---                                  
 996: 2.20473789  2.7760518 3.506689002
 997: 0.67635816  6.1153578 3.143228227
 998: 1.89649565  6.3148116 4.185582404
 999: 0.03379467 -0.2925077 0.200483835
1000: 2.51539783  1.7992266 2.437934475</code></pre>
</div>
</div>
<p>We can now train a linear model using the bootstrapped data and calculate <span class="math inline">\(\hat{x}^*\)</span> based on it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>reg <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x <span class="sc">+</span> <span class="fu">I</span>(x<span class="sc">^</span><span class="dv">2</span>), <span class="at">data =</span> boot_data)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>x_star <span class="ot">&lt;-</span> (<span class="dv">2</span> <span class="sc">-</span> <span class="dv">5</span> <span class="sc">*</span> reg<span class="sc">$</span>coef[<span class="st">"x"</span>])<span class="sc">/</span> (<span class="dv">10</span> <span class="sc">*</span> reg<span class="sc">$</span>coef[<span class="st">"I(x^2)"</span>])</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       x 
1.367197 </code></pre>
</div>
</div>
<p>We can loop this process over all the <span class="math inline">\(100\)</span> (<span class="math inline">\(M = 100\)</span>) bootstrapped data from the fist subsample set. Before that, let’s define a function that conducts a single implementation of bootstrapping and estimating <span class="math inline">\(x^*\)</span> from a single subsample set.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>get_xstar_boot <span class="ot">&lt;-</span> <span class="cf">function</span>(subsample)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  boot_data <span class="ot">&lt;-</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sample</span>(</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">seq_len</span>(<span class="fu">nrow</span>(subsample)),</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>      N,</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">replace =</span> <span class="cn">TRUE</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>    subsample[., ]</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>  reg <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x <span class="sc">+</span> <span class="fu">I</span>(x<span class="sc">^</span><span class="dv">2</span>), <span class="at">data =</span> boot_data)</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>  x_star <span class="ot">&lt;-</span> (<span class="dv">2</span> <span class="sc">-</span> <span class="dv">5</span> <span class="sc">*</span> reg<span class="sc">$</span>coef[<span class="st">"x"</span>])<span class="sc">/</span> (<span class="dv">10</span> <span class="sc">*</span> reg<span class="sc">$</span>coef[<span class="st">"I(x^2)"</span>])</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x_star)</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This is a single iteration.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_xstar_boot</span>(subsamples[[<span class="dv">1</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       x 
1.400198 </code></pre>
</div>
</div>
<p>Now, let’s repeat this 100 (<span class="math inline">\(M = 100\)</span>) times.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>M <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>xstar_hats <span class="ot">&lt;-</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span><span class="sc">:</span>M,</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(x) <span class="fu">get_xstar_boot</span>(subsamples[[<span class="dv">1</span>]])</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlist</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can now get the 95% confidence interval of <span class="math inline">\(\hat{x}^*\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>cf_lower <span class="ot">&lt;-</span> <span class="fu">quantile</span>(xstar_hats, <span class="at">prob =</span> <span class="fl">0.025</span>) </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>cf_upper <span class="ot">&lt;-</span> <span class="fu">quantile</span>(xstar_hats, <span class="at">prob =</span> <span class="fl">0.975</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>So, [1.36848876286897,1.44320748221065] is the 95% confidence interval estimate from the first subsample set. We repeat this for the other subsample sets and average the 95% CI from them (<code>get_CI()</code> defined on the side).</p>

<div class="no-row-height column-margin column-container"><div class="">
<p>This function find the 95% confidence interval (<span class="math inline">\(\eta\)</span>) from a single subsample set.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>get_CI <span class="ot">&lt;-</span> <span class="cf">function</span>(subsample){</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  xstar_hats <span class="ot">&lt;-</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lapply</span>(</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>      <span class="dv">1</span><span class="sc">:</span>M,</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>      <span class="cf">function</span>(x) <span class="fu">get_xstar_boot</span>(subsamples[[<span class="dv">1</span>]])</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unlist</span>() </span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>  cf_lower <span class="ot">&lt;-</span> <span class="fu">quantile</span>(xstar_hats, <span class="at">prob =</span> <span class="fl">0.025</span>) </span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>  cf_upper <span class="ot">&lt;-</span> <span class="fu">quantile</span>(xstar_hats, <span class="at">prob =</span> <span class="fl">0.975</span>) </span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>  return_data <span class="ot">&lt;-</span></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.table</span>(</span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">cf_lower =</span> cf_lower,</span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">cf_upper =</span> cf_upper</span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(return_data)</span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div></div><div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>ci_data <span class="ot">&lt;-</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>    subsamples,</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(x) <span class="fu">get_CI</span>(x)</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbindlist</span>()</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   cf_lower cf_upper
1: 1.374328 1.443085
2: 1.368850 1.443649
3: 1.365456 1.444492
4: 1.368362 1.440309
5: 1.362626 1.445573</code></pre>
</div>
</div>
<hr>
<p><strong><span style="color:blue"> Steps 3: </span></strong></p>
<p>By averaging the lower and upper bounds, we get our estimate of the lower and upper bound of the 95% CI of <span class="math inline">\(\hat{x}^*\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>ci_data[, .(<span class="fu">mean</span>(cf_lower), <span class="fu">mean</span>(cf_upper))]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         V1       V2
1: 1.367924 1.443422</code></pre>
</div>
</div>
<p>Note the estimated CI is very much similar to that from a regular bootstrap obtained in <a href="#sec-boot-comp"><span>Section&nbsp;5.3</span></a>.</p>
<div class="callout-tip callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Bag of little bootstraps (BLB) is a variant of bootstrap that has similar desirable statistical properties as bootstrap, but is more computation and memory friendly.</li>
</ul>
<!-- + For example, the `grf` package uses BLB to estimate the standard error of the treatment effect in Causal Forest estimation. -->
</div>
</div>
</section>
</section>
<section id="references" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="references">References</h2>
<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-kleiner_scalable_2014" class="csl-entry" role="doc-biblioentry">
Kleiner, Ariel, Ameet Talwalkar, Purnamrita Sarkar, and Michael I. Jordan. 2014. <span>“A Scalable Bootstrap for Massive Data.”</span> <em>Journal of the Royal Statistical Society: Series B (Statistical Methodology)</em> 76 (4): 795–816. <a href="https://doi.org/10.1111/rssb.12050">https://doi.org/10.1111/rssb.12050</a>.
</div>
</div>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./B04-regularization.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Regression Shrinkage Methods</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./P01-random-forest.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Random Forest</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb61" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Bootstrap {#sec-boot}</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="fu">## What is it for?</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>Bootstrap can be used to quantify the uncertainty associated with an estimator. For example, you can use it to estimate the standard error (SE) of a coefficient of a linear model. Since there are closed-form solutions for that, bootstrap is not really bringing any benefits to this case. However, the power of bootstrap comes in handy when you do NOT have a closed form solution. We will first demonstrate how bootstrap works using a linear model, and then apply it to a case where no-closed form solution is available.</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="fu">## How it works</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>::: {.column-margin}</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>**Packages to load for replication**</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mgcv)</span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(parallel)</span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fixest)</span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ranger)</span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-25"><a href="#cb61-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-28"><a href="#cb61-28" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-29"><a href="#cb61-29" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb61-30"><a href="#cb61-30" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb61-31"><a href="#cb61-31" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb61-32"><a href="#cb61-32" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mgcv)</span>
<span id="cb61-33"><a href="#cb61-33" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb61-34"><a href="#cb61-34" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(parallel)</span>
<span id="cb61-35"><a href="#cb61-35" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fixest)</span>
<span id="cb61-36"><a href="#cb61-36" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb61-37"><a href="#cb61-37" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ranger)</span>
<span id="cb61-38"><a href="#cb61-38" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-39"><a href="#cb61-39" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb61-40"><a href="#cb61-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-41"><a href="#cb61-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-42"><a href="#cb61-42" aria-hidden="true" tabindex="-1"></a>Here are the general steps of a bootstrap:</span>
<span id="cb61-43"><a href="#cb61-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-44"><a href="#cb61-44" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span>Step 1: Sample the data with replacement (You can sample the same observations more than one times. You draw a ball and then you put it back in the box.)</span>
<span id="cb61-45"><a href="#cb61-45" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span>Step 2: Run a statistical analysis to estimate whatever quantity you are interested in estimating</span>
<span id="cb61-46"><a href="#cb61-46" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span>Repeat Steps 1 and 2 many times and store the estimates</span>
<span id="cb61-47"><a href="#cb61-47" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span>Derive uncertainty measures from the collection of estimates obtained above</span>
<span id="cb61-48"><a href="#cb61-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-49"><a href="#cb61-49" aria-hidden="true" tabindex="-1"></a>Let's demonstrate this using a very simple linear regression example.</span>
<span id="cb61-50"><a href="#cb61-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-51"><a href="#cb61-51" aria-hidden="true" tabindex="-1"></a>Here is the data generating process:</span>
<span id="cb61-52"><a href="#cb61-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-55"><a href="#cb61-55" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-56"><a href="#cb61-56" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">89343</span>)</span>
<span id="cb61-57"><a href="#cb61-57" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb61-58"><a href="#cb61-58" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N)</span>
<span id="cb61-59"><a href="#cb61-59" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> x <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">rnorm</span>(N)</span>
<span id="cb61-60"><a href="#cb61-60" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-61"><a href="#cb61-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-62"><a href="#cb61-62" aria-hidden="true" tabindex="-1"></a>We would like to estimate the coefficient on $x$ by applying OLS to the following model:</span>
<span id="cb61-63"><a href="#cb61-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-64"><a href="#cb61-64" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb61-65"><a href="#cb61-65" aria-hidden="true" tabindex="-1"></a>y = \alpha + \beta_x + \mu</span>
<span id="cb61-66"><a href="#cb61-66" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb61-67"><a href="#cb61-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-68"><a href="#cb61-68" aria-hidden="true" tabindex="-1"></a>We know from the econometric theory class that the SE of $\hat{\beta}_{OLS}$ is $\frac{\sigma}{\sqrt{SST_x}}$, where $\sigma^2$ is the variance of the error term ($\mu$) and $SST_x = \sum_{i=1}^N (x_i - \bar{x})^2$ ($\bar{x}$ is the mean of $x$).  </span>
<span id="cb61-69"><a href="#cb61-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-72"><a href="#cb61-72" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-73"><a href="#cb61-73" aria-hidden="true" tabindex="-1"></a>mean_x <span class="ot">&lt;-</span> <span class="fu">mean</span>(x)</span>
<span id="cb61-74"><a href="#cb61-74" aria-hidden="true" tabindex="-1"></a>sst_x <span class="ot">&lt;-</span> ((x<span class="sc">-</span><span class="fu">mean</span>(x))<span class="sc">^</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> <span class="fu">sum</span>()</span>
<span id="cb61-75"><a href="#cb61-75" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb61-76"><a href="#cb61-76" aria-hidden="true" tabindex="-1"></a>se_bhat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="dv">4</span> <span class="sc">/</span> sst_x)</span>
<span id="cb61-77"><a href="#cb61-77" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-78"><a href="#cb61-78" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-79"><a href="#cb61-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-80"><a href="#cb61-80" aria-hidden="true" tabindex="-1"></a>So, we know that the true SE of $\hat{\beta}_{OLS}$ is <span class="in">`r se_bhat`</span>. There is not really any point in using bootstrap in this case, but this is a good example to see if bootstrap works or not.</span>
<span id="cb61-81"><a href="#cb61-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-82"><a href="#cb61-82" aria-hidden="true" tabindex="-1"></a>Let's implement a single iteration of the entire bootstrap steps (Steps 1 and 2).</span>
<span id="cb61-83"><a href="#cb61-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-86"><a href="#cb61-86" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-87"><a href="#cb61-87" aria-hidden="true" tabindex="-1"></a><span class="co">#=== set up a dataset ===#</span></span>
<span id="cb61-88"><a href="#cb61-88" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span></span>
<span id="cb61-89"><a href="#cb61-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.table</span>(</span>
<span id="cb61-90"><a href="#cb61-90" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> y,</span>
<span id="cb61-91"><a href="#cb61-91" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> x</span>
<span id="cb61-92"><a href="#cb61-92" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb61-93"><a href="#cb61-93" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-94"><a href="#cb61-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-95"><a href="#cb61-95" aria-hidden="true" tabindex="-1"></a>Now, draw observations with replacement so the resulting dataset has the same number of observations as the original dataset.</span>
<span id="cb61-96"><a href="#cb61-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-99"><a href="#cb61-99" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-100"><a href="#cb61-100" aria-hidden="true" tabindex="-1"></a>num_obs <span class="ot">&lt;-</span> <span class="fu">nrow</span>(data)</span>
<span id="cb61-101"><a href="#cb61-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-102"><a href="#cb61-102" aria-hidden="true" tabindex="-1"></a><span class="co">#=== draw row numbers ===#</span></span>
<span id="cb61-103"><a href="#cb61-103" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb61-104"><a href="#cb61-104" aria-hidden="true" tabindex="-1"></a>row_indices <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">seq_len</span>(num_obs), num_obs, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb61-105"><a href="#cb61-105" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-106"><a href="#cb61-106" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-107"><a href="#cb61-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-108"><a href="#cb61-108" aria-hidden="true" tabindex="-1"></a>Use the sampled indices to create a bootstrapped dataset:</span>
<span id="cb61-109"><a href="#cb61-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-110"><a href="#cb61-110" aria-hidden="true" tabindex="-1"></a>::: {.column-margin}</span>
<span id="cb61-111"><a href="#cb61-111" aria-hidden="true" tabindex="-1"></a>You could also use <span class="in">`bootstraps()`</span> from the <span class="in">`rsample`</span> package. </span>
<span id="cb61-112"><a href="#cb61-112" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb61-113"><a href="#cb61-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-116"><a href="#cb61-116" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-117"><a href="#cb61-117" aria-hidden="true" tabindex="-1"></a>temp_data <span class="ot">&lt;-</span> data[row_indices, ]</span>
<span id="cb61-118"><a href="#cb61-118" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-119"><a href="#cb61-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-120"><a href="#cb61-120" aria-hidden="true" tabindex="-1"></a>Now, apply OLS to get a coefficient estimate on $x$ using the bootstrapped dataset.</span>
<span id="cb61-121"><a href="#cb61-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-124"><a href="#cb61-124" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-125"><a href="#cb61-125" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> temp_data)<span class="sc">$</span>coefficient[<span class="st">"x"</span>]</span>
<span id="cb61-126"><a href="#cb61-126" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-127"><a href="#cb61-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-128"><a href="#cb61-128" aria-hidden="true" tabindex="-1"></a>This is the end of Steps 1 and 2. Now, let's repeat this step 1000 times. First, we define a function that implements Steps 1 and 2.</span>
<span id="cb61-129"><a href="#cb61-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-132"><a href="#cb61-132" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-133"><a href="#cb61-133" aria-hidden="true" tabindex="-1"></a>get_beta <span class="ot">&lt;-</span> <span class="cf">function</span>(i, data)</span>
<span id="cb61-134"><a href="#cb61-134" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb61-135"><a href="#cb61-135" aria-hidden="true" tabindex="-1"></a>  num_obs <span class="ot">&lt;-</span> <span class="fu">nrow</span>(data)</span>
<span id="cb61-136"><a href="#cb61-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-137"><a href="#cb61-137" aria-hidden="true" tabindex="-1"></a>  <span class="co">#=== sample row numbers ===#</span></span>
<span id="cb61-138"><a href="#cb61-138" aria-hidden="true" tabindex="-1"></a>  row_indices <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">seq_len</span>(num_obs), num_obs, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb61-139"><a href="#cb61-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-140"><a href="#cb61-140" aria-hidden="true" tabindex="-1"></a>  <span class="co">#=== bootstrapped data ===#</span></span>
<span id="cb61-141"><a href="#cb61-141" aria-hidden="true" tabindex="-1"></a>  temp_data <span class="ot">&lt;-</span> data[row_indices, ]</span>
<span id="cb61-142"><a href="#cb61-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-143"><a href="#cb61-143" aria-hidden="true" tabindex="-1"></a>  <span class="co">#=== get coefficient ===#</span></span>
<span id="cb61-144"><a href="#cb61-144" aria-hidden="true" tabindex="-1"></a>  beta_hat <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> temp_data)<span class="sc">$</span>coefficient[<span class="st">"x"</span>]</span>
<span id="cb61-145"><a href="#cb61-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-146"><a href="#cb61-146" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(beta_hat)</span>
<span id="cb61-147"><a href="#cb61-147" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb61-148"><a href="#cb61-148" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-149"><a href="#cb61-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-150"><a href="#cb61-150" aria-hidden="true" tabindex="-1"></a>Now repeat <span class="in">`get_beta()`</span> many times:</span>
<span id="cb61-151"><a href="#cb61-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-154"><a href="#cb61-154" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-155"><a href="#cb61-155" aria-hidden="true" tabindex="-1"></a>beta_store <span class="ot">&lt;-</span></span>
<span id="cb61-156"><a href="#cb61-156" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(</span>
<span id="cb61-157"><a href="#cb61-157" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>,</span>
<span id="cb61-158"><a href="#cb61-158" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(x) <span class="fu">get_beta</span>(x, data)</span>
<span id="cb61-159"><a href="#cb61-159" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb61-160"><a href="#cb61-160" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlist</span>()</span>
<span id="cb61-161"><a href="#cb61-161" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-162"><a href="#cb61-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-163"><a href="#cb61-163" aria-hidden="true" tabindex="-1"></a>Calculate standard deviation of $\hat{\beta}_{OLS}$,</span>
<span id="cb61-164"><a href="#cb61-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-167"><a href="#cb61-167" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-168"><a href="#cb61-168" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(beta_store)</span>
<span id="cb61-169"><a href="#cb61-169" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-170"><a href="#cb61-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-171"><a href="#cb61-171" aria-hidden="true" tabindex="-1"></a>Not, bad. What if we make the number of observations to 1000 instead of 100?</span>
<span id="cb61-172"><a href="#cb61-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-175"><a href="#cb61-175" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-176"><a href="#cb61-176" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">67343</span>)</span>
<span id="cb61-177"><a href="#cb61-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-178"><a href="#cb61-178" aria-hidden="true" tabindex="-1"></a><span class="co">#=== generate data ===#</span></span>
<span id="cb61-179"><a href="#cb61-179" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb61-180"><a href="#cb61-180" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N)</span>
<span id="cb61-181"><a href="#cb61-181" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> x <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">rnorm</span>(N)</span>
<span id="cb61-182"><a href="#cb61-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-183"><a href="#cb61-183" aria-hidden="true" tabindex="-1"></a><span class="co">#=== set up a dataset ===#</span></span>
<span id="cb61-184"><a href="#cb61-184" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span></span>
<span id="cb61-185"><a href="#cb61-185" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.table</span>(</span>
<span id="cb61-186"><a href="#cb61-186" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> y,</span>
<span id="cb61-187"><a href="#cb61-187" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> x</span>
<span id="cb61-188"><a href="#cb61-188" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb61-189"><a href="#cb61-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-190"><a href="#cb61-190" aria-hidden="true" tabindex="-1"></a><span class="co">#=== true SE ===#</span></span>
<span id="cb61-191"><a href="#cb61-191" aria-hidden="true" tabindex="-1"></a>mean_x <span class="ot">&lt;-</span> <span class="fu">mean</span>(x)</span>
<span id="cb61-192"><a href="#cb61-192" aria-hidden="true" tabindex="-1"></a>sst_x <span class="ot">&lt;-</span> <span class="fu">sum</span>(((x<span class="sc">-</span><span class="fu">mean</span>(x))<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb61-193"><a href="#cb61-193" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb61-194"><a href="#cb61-194" aria-hidden="true" tabindex="-1"></a>se_bhat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="dv">4</span> <span class="sc">/</span> sst_x)</span>
<span id="cb61-195"><a href="#cb61-195" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-196"><a href="#cb61-196" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-197"><a href="#cb61-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-200"><a href="#cb61-200" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-201"><a href="#cb61-201" aria-hidden="true" tabindex="-1"></a><span class="co">#=== bootstrap-estimated SE ===#</span></span>
<span id="cb61-202"><a href="#cb61-202" aria-hidden="true" tabindex="-1"></a>beta_store <span class="ot">&lt;-</span></span>
<span id="cb61-203"><a href="#cb61-203" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(</span>
<span id="cb61-204"><a href="#cb61-204" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>,</span>
<span id="cb61-205"><a href="#cb61-205" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(x) <span class="fu">get_beta</span>(x, data)</span>
<span id="cb61-206"><a href="#cb61-206" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb61-207"><a href="#cb61-207" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlist</span>()</span>
<span id="cb61-208"><a href="#cb61-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-209"><a href="#cb61-209" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(beta_store)</span>
<span id="cb61-210"><a href="#cb61-210" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-211"><a href="#cb61-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-212"><a href="#cb61-212" aria-hidden="true" tabindex="-1"></a>This is just a single simulation. So, we cannot say bootstrap works better when the number of sample size is larger only from these experiments. But, it is generally true that bootstrap indeed works better when the number of sample size is larger.</span>
<span id="cb61-213"><a href="#cb61-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-214"><a href="#cb61-214" aria-hidden="true" tabindex="-1"></a><span class="fu">## A more complicated example {#sec-boot-comp}</span></span>
<span id="cb61-215"><a href="#cb61-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-216"><a href="#cb61-216" aria-hidden="true" tabindex="-1"></a>Consider a simple production function (e.g., yield response functions for agronomists):</span>
<span id="cb61-217"><a href="#cb61-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-218"><a href="#cb61-218" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb61-219"><a href="#cb61-219" aria-hidden="true" tabindex="-1"></a>y = \beta_1 x + \beta_2 x^2 + \mu</span>
<span id="cb61-220"><a href="#cb61-220" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb61-221"><a href="#cb61-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-222"><a href="#cb61-222" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$y$: output</span>
<span id="cb61-223"><a href="#cb61-223" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$x$: input</span>
<span id="cb61-224"><a href="#cb61-224" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\mu$: error</span>
<span id="cb61-225"><a href="#cb61-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-226"><a href="#cb61-226" aria-hidden="true" tabindex="-1"></a>The price of $y$ is 5 and the cost of $x$ is 2. Your objective is to identify the amount of input that maximizes profit. You do not know $\beta_1$ and $\beta_2$, and will be estimating them using the data you have collected. Letting $\hat{\beta_1}$ and $\hat{\beta_2}$ denote the estimates of $\beta_1$ and $\beta_2$, respectively, the mathematical expression of the optimization problem is:</span>
<span id="cb61-227"><a href="#cb61-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-228"><a href="#cb61-228" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb61-229"><a href="#cb61-229" aria-hidden="true" tabindex="-1"></a>Max_x 5(\hat{\beta}_1 x + \hat{\beta}_2 x^2) - 2 x</span>
<span id="cb61-230"><a href="#cb61-230" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb61-231"><a href="#cb61-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-232"><a href="#cb61-232" aria-hidden="true" tabindex="-1"></a>The F.O.C is</span>
<span id="cb61-233"><a href="#cb61-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-234"><a href="#cb61-234" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb61-235"><a href="#cb61-235" aria-hidden="true" tabindex="-1"></a>5\hat{\beta}_1 + 10 \hat{\beta}_2 x - 2 = 0</span>
<span id="cb61-236"><a href="#cb61-236" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb61-237"><a href="#cb61-237" aria-hidden="true" tabindex="-1"></a>So, the estimated profit-maximizing input level is $\hat{x}^* = \frac{2-5\hat{\beta}_1}{10\hat{\beta}_2}$. What we are interested in knowing is the SE of $x^*$. As you can see, it is a non-linear function of the coefficients, which makes it slightly harder than simply getting the SE of $\hat{\beta_1}$ or $\hat{\beta_2}$. However, bootstrap can easily get us an estimate of the SE of $\hat{x}^*$. The bootstrap process will be very much the same as the first bootstrap example except that we will estimate $x^*$ in each iteration instead of stopping at estimating just coefficients. Let's work on a single iteration first.</span>
<span id="cb61-238"><a href="#cb61-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-239"><a href="#cb61-239" aria-hidden="true" tabindex="-1"></a>::: {.column-margin}</span>
<span id="cb61-240"><a href="#cb61-240" aria-hidden="true" tabindex="-1"></a>Alternatively, you could use the delta method, which lets you find an estimate of the SE of a statistics that is a non-linear function of estimated coefficients.</span>
<span id="cb61-241"><a href="#cb61-241" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb61-242"><a href="#cb61-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-243"><a href="#cb61-243" aria-hidden="true" tabindex="-1"></a>Here is the data generating process:</span>
<span id="cb61-244"><a href="#cb61-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-247"><a href="#cb61-247" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-248"><a href="#cb61-248" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">894334</span>)</span>
<span id="cb61-249"><a href="#cb61-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-250"><a href="#cb61-250" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span>  <span class="dv">1000</span></span>
<span id="cb61-251"><a href="#cb61-251" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span>  <span class="fu">runif</span>(N) <span class="sc">*</span> <span class="dv">3</span></span>
<span id="cb61-252"><a href="#cb61-252" aria-hidden="true" tabindex="-1"></a>ey <span class="ot">&lt;-</span> <span class="dv">6</span> <span class="sc">*</span> x <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> x<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb61-253"><a href="#cb61-253" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">rnorm</span>(N)</span>
<span id="cb61-254"><a href="#cb61-254" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> ey <span class="sc">+</span> mu</span>
<span id="cb61-255"><a href="#cb61-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-256"><a href="#cb61-256" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> </span>
<span id="cb61-257"><a href="#cb61-257" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.table</span>(</span>
<span id="cb61-258"><a href="#cb61-258" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> x,</span>
<span id="cb61-259"><a href="#cb61-259" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> y,</span>
<span id="cb61-260"><a href="#cb61-260" aria-hidden="true" tabindex="-1"></a>    <span class="at">ey =</span> ey</span>
<span id="cb61-261"><a href="#cb61-261" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb61-262"><a href="#cb61-262" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-263"><a href="#cb61-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-264"><a href="#cb61-264" aria-hidden="true" tabindex="-1"></a>Under the data generating process, here is what the production function looks like:</span>
<span id="cb61-265"><a href="#cb61-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-268"><a href="#cb61-268" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-269"><a href="#cb61-269" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb61-270"><a href="#cb61-270" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 3</span></span>
<span id="cb61-271"><a href="#cb61-271" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 5</span></span>
<span id="cb61-272"><a href="#cb61-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-273"><a href="#cb61-273" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> data) <span class="sc">+</span></span>
<span id="cb61-274"><a href="#cb61-274" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> ey, <span class="at">x =</span> x)) <span class="sc">+</span></span>
<span id="cb61-275"><a href="#cb61-275" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb61-276"><a href="#cb61-276" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-277"><a href="#cb61-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-278"><a href="#cb61-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-281"><a href="#cb61-281" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-282"><a href="#cb61-282" aria-hidden="true" tabindex="-1"></a>num_obs <span class="ot">&lt;-</span> <span class="fu">nrow</span>(data)</span>
<span id="cb61-283"><a href="#cb61-283" aria-hidden="true" tabindex="-1"></a>row_indices <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">seq_len</span>(num_obs), num_obs, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb61-284"><a href="#cb61-284" aria-hidden="true" tabindex="-1"></a>boot_data <span class="ot">&lt;-</span> data[row_indices, ]</span>
<span id="cb61-285"><a href="#cb61-285" aria-hidden="true" tabindex="-1"></a>reg <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x <span class="sc">+</span> <span class="fu">I</span>(x<span class="sc">^</span><span class="dv">2</span>), <span class="at">data =</span> boot_data)</span>
<span id="cb61-286"><a href="#cb61-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-287"><a href="#cb61-287" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-288"><a href="#cb61-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-289"><a href="#cb61-289" aria-hidden="true" tabindex="-1"></a>Now that we have estimated $\beta_1$ and $\beta_2$, we can easily estimate $x^*$ using its analytical formula.</span>
<span id="cb61-290"><a href="#cb61-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-293"><a href="#cb61-293" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-294"><a href="#cb61-294" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb61-295"><a href="#cb61-295" aria-hidden="true" tabindex="-1"></a>x_star <span class="ot">&lt;-</span> (<span class="dv">2</span> <span class="sc">-</span> <span class="dv">5</span> <span class="sc">*</span> reg<span class="sc">$</span>coef[<span class="st">"x"</span>])<span class="sc">/</span> (<span class="dv">10</span> <span class="sc">*</span> reg<span class="sc">$</span>coef[<span class="st">"I(x^2)"</span>])</span>
<span id="cb61-296"><a href="#cb61-296" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-297"><a href="#cb61-297" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-298"><a href="#cb61-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-299"><a href="#cb61-299" aria-hidden="true" tabindex="-1"></a>We can repeat this many times to get a collection of $x^*$ estimates and calculate the standard deviation.</span>
<span id="cb61-300"><a href="#cb61-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-303"><a href="#cb61-303" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-304"><a href="#cb61-304" aria-hidden="true" tabindex="-1"></a>get_x_star <span class="ot">&lt;-</span> <span class="cf">function</span>(i)</span>
<span id="cb61-305"><a href="#cb61-305" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb61-306"><a href="#cb61-306" aria-hidden="true" tabindex="-1"></a>  row_indices <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">seq_len</span>(num_obs), num_obs, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb61-307"><a href="#cb61-307" aria-hidden="true" tabindex="-1"></a>  boot_data <span class="ot">&lt;-</span> data[row_indices, ]</span>
<span id="cb61-308"><a href="#cb61-308" aria-hidden="true" tabindex="-1"></a>  reg <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x <span class="sc">+</span> <span class="fu">I</span>(x<span class="sc">^</span><span class="dv">2</span>), <span class="at">data =</span> boot_data)</span>
<span id="cb61-309"><a href="#cb61-309" aria-hidden="true" tabindex="-1"></a>  x_star <span class="ot">&lt;-</span> (<span class="dv">2</span> <span class="sc">-</span> <span class="dv">5</span> <span class="sc">*</span> reg<span class="sc">$</span>coef[<span class="st">"x"</span>])<span class="sc">/</span> (<span class="dv">10</span> <span class="sc">*</span> reg<span class="sc">$</span>coef[<span class="st">"I(x^2)"</span>])</span>
<span id="cb61-310"><a href="#cb61-310" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb61-311"><a href="#cb61-311" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-312"><a href="#cb61-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-315"><a href="#cb61-315" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-316"><a href="#cb61-316" aria-hidden="true" tabindex="-1"></a>x_stars <span class="ot">&lt;-</span> </span>
<span id="cb61-317"><a href="#cb61-317" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(</span>
<span id="cb61-318"><a href="#cb61-318" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>,</span>
<span id="cb61-319"><a href="#cb61-319" aria-hidden="true" tabindex="-1"></a>    get_x_star</span>
<span id="cb61-320"><a href="#cb61-320" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb61-321"><a href="#cb61-321" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlist</span>()</span>
<span id="cb61-322"><a href="#cb61-322" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-323"><a href="#cb61-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-324"><a href="#cb61-324" aria-hidden="true" tabindex="-1"></a>Here is the histogram:</span>
<span id="cb61-325"><a href="#cb61-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-328"><a href="#cb61-328" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-329"><a href="#cb61-329" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb61-330"><a href="#cb61-330" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb61-331"><a href="#cb61-331" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb61-332"><a href="#cb61-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-333"><a href="#cb61-333" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(x_stars, <span class="at">breaks =</span> <span class="dv">30</span>)</span>
<span id="cb61-334"><a href="#cb61-334" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-335"><a href="#cb61-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-336"><a href="#cb61-336" aria-hidden="true" tabindex="-1"></a>So, it seems to follow a normal distribution. You can get standard deviation of <span class="in">`x_stars`</span> as an estimate of the SE of $\hat{x}^*$.</span>
<span id="cb61-337"><a href="#cb61-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-340"><a href="#cb61-340" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-341"><a href="#cb61-341" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(x_stars)</span>
<span id="cb61-342"><a href="#cb61-342" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-343"><a href="#cb61-343" aria-hidden="true" tabindex="-1"></a>You can get the 95% confidence interval (CI) like below:</span>
<span id="cb61-344"><a href="#cb61-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-347"><a href="#cb61-347" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-348"><a href="#cb61-348" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(x_stars, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))</span>
<span id="cb61-349"><a href="#cb61-349" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-350"><a href="#cb61-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-351"><a href="#cb61-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-352"><a href="#cb61-352" aria-hidden="true" tabindex="-1"></a><span class="fu">## One more example with a non-parametric model</span></span>
<span id="cb61-353"><a href="#cb61-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-354"><a href="#cb61-354" aria-hidden="true" tabindex="-1"></a>We now demonstrate how we can use bootstrap to get an estimate of the SE of $\hat{x}^*$ when we use random forest (RF) as our regression method instead of OLS. When RF is used, we do not have any coefficients like the OLS case above. Even then, bootstrap allows us to estimate the SE of $\hat{x}^*$.</span>
<span id="cb61-355"><a href="#cb61-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-356"><a href="#cb61-356" aria-hidden="true" tabindex="-1"></a>::: {.column-margin}</span>
<span id="cb61-357"><a href="#cb61-357" aria-hidden="true" tabindex="-1"></a>RF will be covered in @sec-rf. Please take a quick glance at what RF is to confirm this point. No deep understanding of RF is necessary to understand the significance of bootstrap in this example. Please also note that there is no benefit in using RF in this example because we have only one variable and semi-parametric approach like <span class="in">`gam()`</span> will certainly do better. RF is used here only because it does not give you coefficient estimates (there are no coefficients in the first place for RF) like linear models.</span>
<span id="cb61-358"><a href="#cb61-358" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb61-359"><a href="#cb61-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-360"><a href="#cb61-360" aria-hidden="true" tabindex="-1"></a>The procedure is exactly the same except that we use RF to estimate the production function and also that we need to conduct numerical optimization as no analytical formula is available unlike the case above. </span>
<span id="cb61-361"><a href="#cb61-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-362"><a href="#cb61-362" aria-hidden="true" tabindex="-1"></a>We first implement a single iteration. </span>
<span id="cb61-363"><a href="#cb61-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-366"><a href="#cb61-366" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-367"><a href="#cb61-367" aria-hidden="true" tabindex="-1"></a><span class="co">#=== get bootstrapped data ===#</span></span>
<span id="cb61-368"><a href="#cb61-368" aria-hidden="true" tabindex="-1"></a>row_indices <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">seq_len</span>(num_obs), num_obs, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb61-369"><a href="#cb61-369" aria-hidden="true" tabindex="-1"></a>boot_data <span class="ot">&lt;-</span> data[row_indices, ]</span>
<span id="cb61-370"><a href="#cb61-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-371"><a href="#cb61-371" aria-hidden="true" tabindex="-1"></a><span class="co">#=== train RF ===#</span></span>
<span id="cb61-372"><a href="#cb61-372" aria-hidden="true" tabindex="-1"></a>reg_rf <span class="ot">&lt;-</span> <span class="fu">ranger</span>(y <span class="sc">~</span> x, <span class="at">data =</span> boot_data)</span>
<span id="cb61-373"><a href="#cb61-373" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-374"><a href="#cb61-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-375"><a href="#cb61-375" aria-hidden="true" tabindex="-1"></a>Once you train RF, we can predict yield at a range of values of $x$, calculate profit, and then pick the value of $x$ that maximizes the estimated profit. </span>
<span id="cb61-376"><a href="#cb61-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-379"><a href="#cb61-379" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-380"><a href="#cb61-380" aria-hidden="true" tabindex="-1"></a><span class="co">#=== create series of x values at which yield will be predicted ===#</span></span>
<span id="cb61-381"><a href="#cb61-381" aria-hidden="true" tabindex="-1"></a>eval_data <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">3</span>, <span class="at">length =</span> <span class="dv">1000</span>))</span>
<span id="cb61-382"><a href="#cb61-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-383"><a href="#cb61-383" aria-hidden="true" tabindex="-1"></a><span class="co">#=== predict yield based on the trained RF ===#</span></span>
<span id="cb61-384"><a href="#cb61-384" aria-hidden="true" tabindex="-1"></a>eval_data[, y_hat <span class="sc">:</span><span class="er">=</span> <span class="fu">predict</span>(reg_rf, eval_data)<span class="sc">$</span>predictions]</span>
<span id="cb61-385"><a href="#cb61-385" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-386"><a href="#cb61-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-387"><a href="#cb61-387" aria-hidden="true" tabindex="-1"></a>Here is what the estimated production function looks like:</span>
<span id="cb61-388"><a href="#cb61-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-391"><a href="#cb61-391" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-392"><a href="#cb61-392" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb61-393"><a href="#cb61-393" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb61-394"><a href="#cb61-394" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb61-395"><a href="#cb61-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-396"><a href="#cb61-396" aria-hidden="true" tabindex="-1"></a><span class="co">#=== plot ===#</span></span>
<span id="cb61-397"><a href="#cb61-397" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> eval_data) <span class="sc">+</span></span>
<span id="cb61-398"><a href="#cb61-398" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> y_hat, <span class="at">x =</span> x)) <span class="sc">+</span></span>
<span id="cb61-399"><a href="#cb61-399" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb61-400"><a href="#cb61-400" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-401"><a href="#cb61-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-402"><a href="#cb61-402" aria-hidden="true" tabindex="-1"></a>Well, it is very spiky (we need to tune hyper-parameters using KCV. But, more on this later. The quality of RF estimation has nothing to do with the goal of this section). </span>
<span id="cb61-403"><a href="#cb61-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-404"><a href="#cb61-404" aria-hidden="true" tabindex="-1"></a>We can now predict profit at each value of $x$.</span>
<span id="cb61-405"><a href="#cb61-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-408"><a href="#cb61-408" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-409"><a href="#cb61-409" aria-hidden="true" tabindex="-1"></a><span class="co">#=== calculate profit ===#</span></span>
<span id="cb61-410"><a href="#cb61-410" aria-hidden="true" tabindex="-1"></a>eval_data[, profit_hat <span class="sc">:</span><span class="er">=</span> <span class="dv">5</span> <span class="sc">*</span> y_hat <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> x]</span>
<span id="cb61-411"><a href="#cb61-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-412"><a href="#cb61-412" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(eval_data)</span>
<span id="cb61-413"><a href="#cb61-413" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-414"><a href="#cb61-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-415"><a href="#cb61-415" aria-hidden="true" tabindex="-1"></a>The only thing left for us to do is find the $x$ value that maximizes profit. </span>
<span id="cb61-416"><a href="#cb61-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-417"><a href="#cb61-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-420"><a href="#cb61-420" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-421"><a href="#cb61-421" aria-hidden="true" tabindex="-1"></a>eval_data[<span class="fu">which.max</span>(profit_hat), ]</span>
<span id="cb61-422"><a href="#cb61-422" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-423"><a href="#cb61-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-424"><a href="#cb61-424" aria-hidden="true" tabindex="-1"></a>Okay, so <span class="in">`r eval_data[which.max(profit_hat), x]`</span> is the $\hat{x}^*$ from this iteration.</span>
<span id="cb61-425"><a href="#cb61-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-426"><a href="#cb61-426" aria-hidden="true" tabindex="-1"></a>As you might have guessed already, we can just repeat this step to get an estimate of the SE of $\hat{x}^*_{RF}$.</span>
<span id="cb61-427"><a href="#cb61-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-430"><a href="#cb61-430" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-431"><a href="#cb61-431" aria-hidden="true" tabindex="-1"></a>get_x_star_rf <span class="ot">&lt;-</span> <span class="cf">function</span>(i)</span>
<span id="cb61-432"><a href="#cb61-432" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb61-433"><a href="#cb61-433" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(i) <span class="co"># progress tracker</span></span>
<span id="cb61-434"><a href="#cb61-434" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-435"><a href="#cb61-435" aria-hidden="true" tabindex="-1"></a>  <span class="co">#=== get bootstrapped data ===#</span></span>
<span id="cb61-436"><a href="#cb61-436" aria-hidden="true" tabindex="-1"></a>  row_indices <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">seq_len</span>(num_obs), num_obs, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb61-437"><a href="#cb61-437" aria-hidden="true" tabindex="-1"></a>  boot_data <span class="ot">&lt;-</span> data[row_indices, ]</span>
<span id="cb61-438"><a href="#cb61-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-439"><a href="#cb61-439" aria-hidden="true" tabindex="-1"></a>  <span class="co">#=== train RF ===#</span></span>
<span id="cb61-440"><a href="#cb61-440" aria-hidden="true" tabindex="-1"></a>  reg_rf <span class="ot">&lt;-</span> <span class="fu">ranger</span>(y <span class="sc">~</span> x, <span class="at">data =</span> boot_data)</span>
<span id="cb61-441"><a href="#cb61-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-442"><a href="#cb61-442" aria-hidden="true" tabindex="-1"></a>  <span class="co">#=== create series of x values at which yield will be predicted ===#</span></span>
<span id="cb61-443"><a href="#cb61-443" aria-hidden="true" tabindex="-1"></a>  eval_data <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">3</span>, <span class="at">length =</span> <span class="dv">1000</span>))</span>
<span id="cb61-444"><a href="#cb61-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-445"><a href="#cb61-445" aria-hidden="true" tabindex="-1"></a>  <span class="co">#=== predict yield based on the trained RF ===#</span></span>
<span id="cb61-446"><a href="#cb61-446" aria-hidden="true" tabindex="-1"></a>  eval_data[, y_hat <span class="sc">:</span><span class="er">=</span> <span class="fu">predict</span>(reg_rf, eval_data)<span class="sc">$</span>predictions]</span>
<span id="cb61-447"><a href="#cb61-447" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-448"><a href="#cb61-448" aria-hidden="true" tabindex="-1"></a>  <span class="co">#=== calculate profit ===#</span></span>
<span id="cb61-449"><a href="#cb61-449" aria-hidden="true" tabindex="-1"></a>  eval_data[, profit_hat <span class="sc">:</span><span class="er">=</span> <span class="dv">5</span> <span class="sc">*</span> y_hat <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> x]</span>
<span id="cb61-450"><a href="#cb61-450" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-451"><a href="#cb61-451" aria-hidden="true" tabindex="-1"></a>  <span class="co">#=== find x_star_hat ===#</span></span>
<span id="cb61-452"><a href="#cb61-452" aria-hidden="true" tabindex="-1"></a>  x_star_hat <span class="ot">&lt;-</span> eval_data[<span class="fu">which.max</span>(profit_hat), x]</span>
<span id="cb61-453"><a href="#cb61-453" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-454"><a href="#cb61-454" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x_star_hat)</span>
<span id="cb61-455"><a href="#cb61-455" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb61-456"><a href="#cb61-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-457"><a href="#cb61-457" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-458"><a href="#cb61-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-459"><a href="#cb61-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-462"><a href="#cb61-462" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-463"><a href="#cb61-463" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: true</span></span>
<span id="cb61-464"><a href="#cb61-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-465"><a href="#cb61-465" aria-hidden="true" tabindex="-1"></a>x_stars_rf <span class="ot">&lt;-</span> </span>
<span id="cb61-466"><a href="#cb61-466" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mclapply</span>(</span>
<span id="cb61-467"><a href="#cb61-467" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>,</span>
<span id="cb61-468"><a href="#cb61-468" aria-hidden="true" tabindex="-1"></a>    get_x_star_rf,</span>
<span id="cb61-469"><a href="#cb61-469" aria-hidden="true" tabindex="-1"></a>    <span class="at">mc.cores =</span> <span class="dv">12</span></span>
<span id="cb61-470"><a href="#cb61-470" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb61-471"><a href="#cb61-471" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlist</span>()</span>
<span id="cb61-472"><a href="#cb61-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-473"><a href="#cb61-473" aria-hidden="true" tabindex="-1"></a><span class="co">#=== Windows user ===#</span></span>
<span id="cb61-474"><a href="#cb61-474" aria-hidden="true" tabindex="-1"></a><span class="co"># library(future.apply)</span></span>
<span id="cb61-475"><a href="#cb61-475" aria-hidden="true" tabindex="-1"></a><span class="co"># plan("multisession", workers = detectCores() - 2)</span></span>
<span id="cb61-476"><a href="#cb61-476" aria-hidden="true" tabindex="-1"></a><span class="co"># x_stars_rf &lt;- </span></span>
<span id="cb61-477"><a href="#cb61-477" aria-hidden="true" tabindex="-1"></a><span class="co">#   future_lapply(</span></span>
<span id="cb61-478"><a href="#cb61-478" aria-hidden="true" tabindex="-1"></a><span class="co">#     1:1000,</span></span>
<span id="cb61-479"><a href="#cb61-479" aria-hidden="true" tabindex="-1"></a><span class="co">#     get_x_star_rf</span></span>
<span id="cb61-480"><a href="#cb61-480" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) %&gt;%</span></span>
<span id="cb61-481"><a href="#cb61-481" aria-hidden="true" tabindex="-1"></a><span class="co">#   unlist()</span></span>
<span id="cb61-482"><a href="#cb61-482" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-483"><a href="#cb61-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-484"><a href="#cb61-484" aria-hidden="true" tabindex="-1"></a>Here are the estimate of the SE of $\hat{x}^*_{RF}$ and 95% CI.</span>
<span id="cb61-485"><a href="#cb61-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-488"><a href="#cb61-488" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-489"><a href="#cb61-489" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(x_stars_rf)</span>
<span id="cb61-490"><a href="#cb61-490" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(x_stars_rf, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))</span>
<span id="cb61-491"><a href="#cb61-491" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-492"><a href="#cb61-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-493"><a href="#cb61-493" aria-hidden="true" tabindex="-1"></a>As you can see, the estimation of $x^*$ is much more inaccurate than the previous OLS approach. This is likely due to the fact that we are not doing a good job of tuning the hyper-parameters of RF (but, again, more on this later).</span>
<span id="cb61-494"><a href="#cb61-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-495"><a href="#cb61-495" aria-hidden="true" tabindex="-1"></a>This conclude the illustration of the power of using bootstrap to estimate the uncertainty of the statistics of interest ($x^*$ here) when the analytical formula of the statistics is non-linear or not even known. </span>
<span id="cb61-496"><a href="#cb61-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-497"><a href="#cb61-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-498"><a href="#cb61-498" aria-hidden="true" tabindex="-1"></a><span class="fu">## Bag of Little Bootstraps</span></span>
<span id="cb61-499"><a href="#cb61-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-500"><a href="#cb61-500" aria-hidden="true" tabindex="-1"></a>Bag of little bootstraps (BLB) is a variant of bootstrap that has similar desirable statistical properties as bootstrap, but is more (computer) memory friendly <span class="co">[</span><span class="ot">@kleiner_scalable_2014</span><span class="co">]</span>.</span>
<span id="cb61-501"><a href="#cb61-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-502"><a href="#cb61-502" aria-hidden="true" tabindex="-1"></a>When the sample size is large (say 1GB) bootstrap is computationally costly both in terms of time and memory because the data of the same size is bootstrapped for many times (say, 1000 times). BLB overcomes this problem.</span>
<span id="cb61-503"><a href="#cb61-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-504"><a href="#cb61-504" aria-hidden="true" tabindex="-1"></a>Suppose you are interested in $\eta$ (e.g., standard error, confidence interval) of the estimator $\hat{\theta}$. Further, let $N$ denoted the sample size of the training data.</span>
<span id="cb61-505"><a href="#cb61-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-506"><a href="#cb61-506" aria-hidden="true" tabindex="-1"></a>BLB works as follows: </span>
<span id="cb61-507"><a href="#cb61-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-508"><a href="#cb61-508" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Split the dataset into $S$ sets of subsamples of size $B$ so that $s \times B = N$ <span class="kw">&lt;span</span> <span class="er">style</span><span class="ot">=</span><span class="st">"color:blue"</span><span class="kw">&gt;</span> without replacement<span class="kw">&lt;/span&gt;</span>.</span>
<span id="cb61-509"><a href="#cb61-509" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>For each of the subsample, bootstrap $N$ (<span class="kw">&lt;span</span> <span class="er">style</span><span class="ot">=</span><span class="st">"color:red"</span><span class="kw">&gt;</span> not $B$ <span class="kw">&lt;/span&gt;</span>) samples <span class="kw">&lt;span</span> <span class="er">style</span><span class="ot">=</span><span class="st">"color:blue"</span><span class="kw">&gt;</span> with replacement <span class="kw">&lt;/span&gt;</span> $M$ times, and find $\eta$ (call it $\eta_s$) for each of the subsample sets.</span>
<span id="cb61-510"><a href="#cb61-510" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Average $\hat{\eta}_s$ to get $\hat{eta}$.</span>
<span id="cb61-511"><a href="#cb61-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-512"><a href="#cb61-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-513"><a href="#cb61-513" aria-hidden="true" tabindex="-1"></a><span class="fu">### Demonstrations </span></span>
<span id="cb61-514"><a href="#cb61-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-515"><a href="#cb61-515" aria-hidden="true" tabindex="-1"></a>Let's go back to the example discussed in @sec-boot-comp, where the goal is to identify the confidence interval ($\eta$) of the economically optimal input rate ($\theta$).</span>
<span id="cb61-516"><a href="#cb61-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-517"><a href="#cb61-517" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb61-518"><a href="#cb61-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-519"><a href="#cb61-519" aria-hidden="true" tabindex="-1"></a>**&lt;span style="color:blue"&gt; Step 1: &lt;/span&gt;**</span>
<span id="cb61-520"><a href="#cb61-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-521"><a href="#cb61-521" aria-hidden="true" tabindex="-1"></a>::: {.column-margin}</span>
<span id="cb61-522"><a href="#cb61-522" aria-hidden="true" tabindex="-1"></a>Step 1: Split the dataset into $S$ sets of subsamples of size $B$ so that $s \times B = N$ <span class="kw">&lt;span</span> <span class="er">style</span><span class="ot">=</span><span class="st">"color:blue"</span><span class="kw">&gt;</span> without replacement<span class="kw">&lt;/span&gt;</span></span>
<span id="cb61-523"><a href="#cb61-523" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb61-524"><a href="#cb61-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-525"><a href="#cb61-525" aria-hidden="true" tabindex="-1"></a>Here, we set $S$ at 5, so $B = <span class="in">`r nrow(data)/5`</span>$. </span>
<span id="cb61-526"><a href="#cb61-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-529"><a href="#cb61-529" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-530"><a href="#cb61-530" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="fu">nrow</span>(data)</span>
<span id="cb61-531"><a href="#cb61-531" aria-hidden="true" tabindex="-1"></a>S <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb61-532"><a href="#cb61-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-533"><a href="#cb61-533" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb61-534"><a href="#cb61-534" aria-hidden="true" tabindex="-1"></a>subsamples <span class="ot">&lt;-</span></span>
<span id="cb61-535"><a href="#cb61-535" aria-hidden="true" tabindex="-1"></a>  data[<span class="fu">sample</span>(<span class="fu">seq_len</span>(N), N), ] <span class="sc">%&gt;%</span></span>
<span id="cb61-536"><a href="#cb61-536" aria-hidden="true" tabindex="-1"></a>  .[, <span class="at">subgroup :=</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>S, <span class="at">each =</span> N<span class="sc">/</span>S)] <span class="sc">%&gt;%</span> </span>
<span id="cb61-537"><a href="#cb61-537" aria-hidden="true" tabindex="-1"></a>  <span class="fu">split</span>(.<span class="sc">$</span>subgroup)</span>
<span id="cb61-538"><a href="#cb61-538" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-539"><a href="#cb61-539" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-540"><a href="#cb61-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-541"><a href="#cb61-541" aria-hidden="true" tabindex="-1"></a>::: {.column-margin}</span>
<span id="cb61-542"><a href="#cb61-542" aria-hidden="true" tabindex="-1"></a>You could alternatively do this:</span>
<span id="cb61-543"><a href="#cb61-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-546"><a href="#cb61-546" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-547"><a href="#cb61-547" aria-hidden="true" tabindex="-1"></a>fold_data <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(data, <span class="at">v =</span> <span class="dv">5</span>)</span>
<span id="cb61-548"><a href="#cb61-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-549"><a href="#cb61-549" aria-hidden="true" tabindex="-1"></a>subsamples <span class="ot">&lt;-</span></span>
<span id="cb61-550"><a href="#cb61-550" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(</span>
<span id="cb61-551"><a href="#cb61-551" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb61-552"><a href="#cb61-552" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(x) fold_data[x, ]<span class="sc">$</span>splits[[<span class="dv">1</span>]] <span class="sc">%&gt;%</span> <span class="fu">assessment</span>()</span>
<span id="cb61-553"><a href="#cb61-553" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb61-554"><a href="#cb61-554" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-555"><a href="#cb61-555" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb61-556"><a href="#cb61-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-557"><a href="#cb61-557" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb61-558"><a href="#cb61-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-559"><a href="#cb61-559" aria-hidden="true" tabindex="-1"></a>**&lt;span style="color:blue"&gt; Steps 2: &lt;/span&gt;**</span>
<span id="cb61-560"><a href="#cb61-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-561"><a href="#cb61-561" aria-hidden="true" tabindex="-1"></a>::: {.column-margin}</span>
<span id="cb61-562"><a href="#cb61-562" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span>Step 2: For each of the subsample, bootstrap $N$ (<span class="kw">&lt;span</span> <span class="er">style</span><span class="ot">=</span><span class="st">"color:red"</span><span class="kw">&gt;</span> not $B$ <span class="kw">&lt;/span&gt;</span>) samples <span class="kw">&lt;span</span> <span class="er">style</span><span class="ot">=</span><span class="st">"color:blue"</span><span class="kw">&gt;</span> with replacement <span class="kw">&lt;/span&gt;</span> $M$ times, and find $\eta$ (call it $\eta_s$) for each of the subsample sets.</span>
<span id="cb61-563"><a href="#cb61-563" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb61-564"><a href="#cb61-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-565"><a href="#cb61-565" aria-hidden="true" tabindex="-1"></a>Instead of creating bootstrapped samples $M$ times, only one bootstrapped sample from the first subsample is created for now, and then the estimate of $x^*$ is obtained. </span>
<span id="cb61-566"><a href="#cb61-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-569"><a href="#cb61-569" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-570"><a href="#cb61-570" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb61-571"><a href="#cb61-571" aria-hidden="true" tabindex="-1"></a>boot_data <span class="ot">&lt;-</span></span>
<span id="cb61-572"><a href="#cb61-572" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample</span>(</span>
<span id="cb61-573"><a href="#cb61-573" aria-hidden="true" tabindex="-1"></a>    <span class="fu">seq_len</span>(<span class="fu">nrow</span>(subsamples[[<span class="dv">1</span>]])),</span>
<span id="cb61-574"><a href="#cb61-574" aria-hidden="true" tabindex="-1"></a>    N,</span>
<span id="cb61-575"><a href="#cb61-575" aria-hidden="true" tabindex="-1"></a>    <span class="at">replace =</span> <span class="cn">TRUE</span></span>
<span id="cb61-576"><a href="#cb61-576" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb61-577"><a href="#cb61-577" aria-hidden="true" tabindex="-1"></a>  subsamples[[<span class="dv">1</span>]][., ]</span>
<span id="cb61-578"><a href="#cb61-578" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-579"><a href="#cb61-579" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-580"><a href="#cb61-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-581"><a href="#cb61-581" aria-hidden="true" tabindex="-1"></a>We can now train a linear model using the bootstrapped data and calculate $\hat{x}^*$ based on it.</span>
<span id="cb61-582"><a href="#cb61-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-585"><a href="#cb61-585" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-586"><a href="#cb61-586" aria-hidden="true" tabindex="-1"></a>reg <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x <span class="sc">+</span> <span class="fu">I</span>(x<span class="sc">^</span><span class="dv">2</span>), <span class="at">data =</span> boot_data)</span>
<span id="cb61-587"><a href="#cb61-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-588"><a href="#cb61-588" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb61-589"><a href="#cb61-589" aria-hidden="true" tabindex="-1"></a>x_star <span class="ot">&lt;-</span> (<span class="dv">2</span> <span class="sc">-</span> <span class="dv">5</span> <span class="sc">*</span> reg<span class="sc">$</span>coef[<span class="st">"x"</span>])<span class="sc">/</span> (<span class="dv">10</span> <span class="sc">*</span> reg<span class="sc">$</span>coef[<span class="st">"I(x^2)"</span>])</span>
<span id="cb61-590"><a href="#cb61-590" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-591"><a href="#cb61-591" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-592"><a href="#cb61-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-593"><a href="#cb61-593" aria-hidden="true" tabindex="-1"></a>We can loop this process over all the $100$ ($M = 100$) bootstrapped data from the fist subsample set. Before that, let's define a function that conducts a single implementation of bootstrapping and estimating $x^*$ from a single subsample set.</span>
<span id="cb61-594"><a href="#cb61-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-595"><a href="#cb61-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-598"><a href="#cb61-598" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-599"><a href="#cb61-599" aria-hidden="true" tabindex="-1"></a>get_xstar_boot <span class="ot">&lt;-</span> <span class="cf">function</span>(subsample)</span>
<span id="cb61-600"><a href="#cb61-600" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb61-601"><a href="#cb61-601" aria-hidden="true" tabindex="-1"></a>  boot_data <span class="ot">&lt;-</span></span>
<span id="cb61-602"><a href="#cb61-602" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sample</span>(</span>
<span id="cb61-603"><a href="#cb61-603" aria-hidden="true" tabindex="-1"></a>      <span class="fu">seq_len</span>(<span class="fu">nrow</span>(subsample)),</span>
<span id="cb61-604"><a href="#cb61-604" aria-hidden="true" tabindex="-1"></a>      N,</span>
<span id="cb61-605"><a href="#cb61-605" aria-hidden="true" tabindex="-1"></a>      <span class="at">replace =</span> <span class="cn">TRUE</span></span>
<span id="cb61-606"><a href="#cb61-606" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb61-607"><a href="#cb61-607" aria-hidden="true" tabindex="-1"></a>    subsample[., ]</span>
<span id="cb61-608"><a href="#cb61-608" aria-hidden="true" tabindex="-1"></a>  reg <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x <span class="sc">+</span> <span class="fu">I</span>(x<span class="sc">^</span><span class="dv">2</span>), <span class="at">data =</span> boot_data)</span>
<span id="cb61-609"><a href="#cb61-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-610"><a href="#cb61-610" aria-hidden="true" tabindex="-1"></a>  x_star <span class="ot">&lt;-</span> (<span class="dv">2</span> <span class="sc">-</span> <span class="dv">5</span> <span class="sc">*</span> reg<span class="sc">$</span>coef[<span class="st">"x"</span>])<span class="sc">/</span> (<span class="dv">10</span> <span class="sc">*</span> reg<span class="sc">$</span>coef[<span class="st">"I(x^2)"</span>])</span>
<span id="cb61-611"><a href="#cb61-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-612"><a href="#cb61-612" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x_star)</span>
<span id="cb61-613"><a href="#cb61-613" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb61-614"><a href="#cb61-614" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-615"><a href="#cb61-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-616"><a href="#cb61-616" aria-hidden="true" tabindex="-1"></a>This is a single iteration.</span>
<span id="cb61-617"><a href="#cb61-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-620"><a href="#cb61-620" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-621"><a href="#cb61-621" aria-hidden="true" tabindex="-1"></a><span class="fu">get_xstar_boot</span>(subsamples[[<span class="dv">1</span>]])</span>
<span id="cb61-622"><a href="#cb61-622" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-623"><a href="#cb61-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-624"><a href="#cb61-624" aria-hidden="true" tabindex="-1"></a>Now, let's repeat this 100 ($M = 100$) times.</span>
<span id="cb61-625"><a href="#cb61-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-628"><a href="#cb61-628" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-629"><a href="#cb61-629" aria-hidden="true" tabindex="-1"></a>M <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb61-630"><a href="#cb61-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-631"><a href="#cb61-631" aria-hidden="true" tabindex="-1"></a>xstar_hats <span class="ot">&lt;-</span></span>
<span id="cb61-632"><a href="#cb61-632" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(</span>
<span id="cb61-633"><a href="#cb61-633" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span><span class="sc">:</span>M,</span>
<span id="cb61-634"><a href="#cb61-634" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(x) <span class="fu">get_xstar_boot</span>(subsamples[[<span class="dv">1</span>]])</span>
<span id="cb61-635"><a href="#cb61-635" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb61-636"><a href="#cb61-636" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlist</span>()</span>
<span id="cb61-637"><a href="#cb61-637" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-638"><a href="#cb61-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-639"><a href="#cb61-639" aria-hidden="true" tabindex="-1"></a>We can now get the 95% confidence interval of $\hat{x}^*$.</span>
<span id="cb61-640"><a href="#cb61-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-643"><a href="#cb61-643" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-644"><a href="#cb61-644" aria-hidden="true" tabindex="-1"></a>cf_lower <span class="ot">&lt;-</span> <span class="fu">quantile</span>(xstar_hats, <span class="at">prob =</span> <span class="fl">0.025</span>) </span>
<span id="cb61-645"><a href="#cb61-645" aria-hidden="true" tabindex="-1"></a>cf_upper <span class="ot">&lt;-</span> <span class="fu">quantile</span>(xstar_hats, <span class="at">prob =</span> <span class="fl">0.975</span>) </span>
<span id="cb61-646"><a href="#cb61-646" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-647"><a href="#cb61-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-648"><a href="#cb61-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-649"><a href="#cb61-649" aria-hidden="true" tabindex="-1"></a>So, <span class="co">[</span><span class="ot">`r paste0(cf_lower, ",", cf_upper)`</span><span class="co">]</span> is the 95% confidence interval estimate from the first subsample set. We repeat this for the other subsample sets and average the 95% CI from them (<span class="in">`get_CI()`</span> defined on the side).</span>
<span id="cb61-650"><a href="#cb61-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-651"><a href="#cb61-651" aria-hidden="true" tabindex="-1"></a>::: {.column-margin}</span>
<span id="cb61-652"><a href="#cb61-652" aria-hidden="true" tabindex="-1"></a>This function find the 95% confidence interval ($\eta$) from a single subsample set.</span>
<span id="cb61-653"><a href="#cb61-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-656"><a href="#cb61-656" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-657"><a href="#cb61-657" aria-hidden="true" tabindex="-1"></a>get_CI <span class="ot">&lt;-</span> <span class="cf">function</span>(subsample){</span>
<span id="cb61-658"><a href="#cb61-658" aria-hidden="true" tabindex="-1"></a>  xstar_hats <span class="ot">&lt;-</span></span>
<span id="cb61-659"><a href="#cb61-659" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lapply</span>(</span>
<span id="cb61-660"><a href="#cb61-660" aria-hidden="true" tabindex="-1"></a>      <span class="dv">1</span><span class="sc">:</span>M,</span>
<span id="cb61-661"><a href="#cb61-661" aria-hidden="true" tabindex="-1"></a>      <span class="cf">function</span>(x) <span class="fu">get_xstar_boot</span>(subsamples[[<span class="dv">1</span>]])</span>
<span id="cb61-662"><a href="#cb61-662" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb61-663"><a href="#cb61-663" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unlist</span>() </span>
<span id="cb61-664"><a href="#cb61-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-665"><a href="#cb61-665" aria-hidden="true" tabindex="-1"></a>  cf_lower <span class="ot">&lt;-</span> <span class="fu">quantile</span>(xstar_hats, <span class="at">prob =</span> <span class="fl">0.025</span>) </span>
<span id="cb61-666"><a href="#cb61-666" aria-hidden="true" tabindex="-1"></a>  cf_upper <span class="ot">&lt;-</span> <span class="fu">quantile</span>(xstar_hats, <span class="at">prob =</span> <span class="fl">0.975</span>) </span>
<span id="cb61-667"><a href="#cb61-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-668"><a href="#cb61-668" aria-hidden="true" tabindex="-1"></a>  return_data <span class="ot">&lt;-</span></span>
<span id="cb61-669"><a href="#cb61-669" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.table</span>(</span>
<span id="cb61-670"><a href="#cb61-670" aria-hidden="true" tabindex="-1"></a>      <span class="at">cf_lower =</span> cf_lower,</span>
<span id="cb61-671"><a href="#cb61-671" aria-hidden="true" tabindex="-1"></a>      <span class="at">cf_upper =</span> cf_upper</span>
<span id="cb61-672"><a href="#cb61-672" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb61-673"><a href="#cb61-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-674"><a href="#cb61-674" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(return_data)</span>
<span id="cb61-675"><a href="#cb61-675" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb61-676"><a href="#cb61-676" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-677"><a href="#cb61-677" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb61-678"><a href="#cb61-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-679"><a href="#cb61-679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-682"><a href="#cb61-682" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-683"><a href="#cb61-683" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb61-684"><a href="#cb61-684" aria-hidden="true" tabindex="-1"></a>ci_data <span class="ot">&lt;-</span></span>
<span id="cb61-685"><a href="#cb61-685" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(</span>
<span id="cb61-686"><a href="#cb61-686" aria-hidden="true" tabindex="-1"></a>    subsamples,</span>
<span id="cb61-687"><a href="#cb61-687" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(x) <span class="fu">get_CI</span>(x)</span>
<span id="cb61-688"><a href="#cb61-688" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb61-689"><a href="#cb61-689" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbindlist</span>()</span>
<span id="cb61-690"><a href="#cb61-690" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-691"><a href="#cb61-691" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-692"><a href="#cb61-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-693"><a href="#cb61-693" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb61-694"><a href="#cb61-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-695"><a href="#cb61-695" aria-hidden="true" tabindex="-1"></a>**&lt;span style="color:blue"&gt; Steps 3: &lt;/span&gt;**</span>
<span id="cb61-696"><a href="#cb61-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-697"><a href="#cb61-697" aria-hidden="true" tabindex="-1"></a>By averaging the lower and upper bounds, we get our estimate of the lower and upper bound of the 95% CI of $\hat{x}^*$.</span>
<span id="cb61-698"><a href="#cb61-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-701"><a href="#cb61-701" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-702"><a href="#cb61-702" aria-hidden="true" tabindex="-1"></a>ci_data[, .(<span class="fu">mean</span>(cf_lower), <span class="fu">mean</span>(cf_upper))]</span>
<span id="cb61-703"><a href="#cb61-703" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-704"><a href="#cb61-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-705"><a href="#cb61-705" aria-hidden="true" tabindex="-1"></a>Note the estimated CI is very much similar to that from a regular bootstrap obtained in @sec-boot-comp.</span>
<span id="cb61-706"><a href="#cb61-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-707"><a href="#cb61-707" aria-hidden="true" tabindex="-1"></a>:::{.callout-tip}</span>
<span id="cb61-708"><a href="#cb61-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-709"><a href="#cb61-709" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span>Bag of little bootstraps (BLB) is a variant of bootstrap that has similar desirable statistical properties as bootstrap, but is more computation and memory friendly.</span>
<span id="cb61-710"><a href="#cb61-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-711"><a href="#cb61-711" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- + For example, the `grf` package uses BLB to estimate the standard error of the treatment effect in Causal Forest estimation. --&gt;</span></span>
<span id="cb61-712"><a href="#cb61-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-713"><a href="#cb61-713" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb61-714"><a href="#cb61-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-715"><a href="#cb61-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-716"><a href="#cb61-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-717"><a href="#cb61-717" aria-hidden="true" tabindex="-1"></a><span class="fu">## References {.unnumbered}</span></span>
<span id="cb61-718"><a href="#cb61-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-719"><a href="#cb61-719" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;div</span> <span class="er">id</span><span class="ot">=</span><span class="st">"refs"</span><span class="kw">&gt;&lt;/div&gt;</span></span>
<span id="cb61-720"><a href="#cb61-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-721"><a href="#cb61-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-722"><a href="#cb61-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-723"><a href="#cb61-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-724"><a href="#cb61-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-725"><a href="#cb61-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-726"><a href="#cb61-726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-727"><a href="#cb61-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-728"><a href="#cb61-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-729"><a href="#cb61-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-730"><a href="#cb61-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-731"><a href="#cb61-731" aria-hidden="true" tabindex="-1"></a></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>